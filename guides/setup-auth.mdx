---
title: 'Setup Auth'
description: 'Configure authentication using Clerk'
---

This guide walks you through setting up authentication in your Agentic Team OS using Clerk.

## Overview

Agentic Team OS uses Clerk for authentication and user management. This guide covers:
- Setting up Clerk
- Configuring authentication in your applications
- Implementing protected routes

## Clerk Setup

1. **Create Clerk Application**
   - Sign up at [clerk.com](https://clerk.com)
   - Create a new application
   - Get your API keys:
     - `CLERK_PUBLISHABLE_KEY`
     - `CLERK_SECRET_KEY`

2. **Configure Environment Variables**
   ```bash
   # .env file
   NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
   CLERK_SECRET_KEY=sk_test_...
   NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
   NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
   NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard
   NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard
   ```

## Dashboard Integration

1. **Add Clerk Provider**
   ```typescript
   // app/providers.tsx
   import { ClerkProvider } from '@clerk/nextjs';
   
   export function Providers({ children }) {
     return (
       <ClerkProvider>
         {children}
       </ClerkProvider>
     );
   }
   ```

2. **Protect Routes**
   ```typescript
   // middleware.ts
   import { authMiddleware } from "@clerk/nextjs";
   
   export default authMiddleware({
     publicRoutes: ["/", "/sign-in", "/sign-up"],
   });
   
   export const config = {
     matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
   };
   ```

3. **Add Auth Components**
   ```typescript
   // app/(auth)/sign-in/[[...sign-in]]/page.tsx
   import { SignIn } from "@clerk/nextjs";
   
   export default function SignInPage() {
     return <SignIn />;
   }
   
   // app/(auth)/sign-up/[[...sign-up]]/page.tsx
   import { SignUp } from "@clerk/nextjs";
   
   export default function SignUpPage() {
     return <SignUp />;
   }
   ```

## API Authentication

1. **Protect API Routes**
   ```typescript
   // packages/functions/src/middleware/auth.ts
   import { clerkClient } from '@clerk/clerk-sdk-node';
   
   export const authenticateRequest = async (event) => {
     try {
       const token = event.headers.authorization?.split(' ')[1];
       if (!token) throw new Error('No token provided');
   
       const session = await clerkClient.sessions.verifyToken(token);
       return session;
     } catch (error) {
       throw new Error('Unauthorized');
     }
   };
   ```

2. **Use in API Handlers**
   ```typescript
   // packages/functions/src/api/protected.ts
   export const handler = async (event) => {
     try {
       const session = await authenticateRequest(event);
       // Handle authenticated request
     } catch (error) {
       return {
         statusCode: 401,
         body: JSON.stringify({ error: 'Unauthorized' }),
       };
     }
   };
   ```

## User Management

1. **Access User Data**
   ```typescript
   import { useUser } from '@clerk/nextjs';
   
   export function Profile() {
     const { user } = useUser();
     
     return (
       <div>
         <h1>Welcome {user.firstName}</h1>
         <p>Email: {user.emailAddresses[0].emailAddress}</p>
       </div>
     );
   }
   ```

2. **Handle User Sessions**
   ```typescript
   import { useAuth } from '@clerk/nextjs';
   
   export function AuthenticatedRequest() {
     const { getToken } = useAuth();
     
     const makeRequest = async () => {
       const token = await getToken();
       // Use token in API requests
     };
   }
   ```

## Social Authentication

1. **Enable Providers**
   - Go to Clerk Dashboard > Social Connections
   - Configure providers (Google, GitHub, etc.)
   - Add OAuth credentials

2. **Customize Sign-In**
   ```typescript
   <SignIn
     appearance={{
       elements: {
         socialButtonsBlockButton: "custom-class",
       },
     }}
   />
   ```

## Best Practices

1. **Security**
   - Enable MFA for sensitive operations
   - Use environment-specific keys
   - Implement proper CORS settings

2. **User Experience**
   - Customize error messages
   - Add proper loading states
   - Implement progressive enhancement

3. **Monitoring**
   - Monitor authentication attempts
   - Track failed logins
   - Set up security alerts

## Next Steps

- [Customize User Billing](/guides/customize-user-billing)
- [Customize Onboarding](/guides/customize-onboarding)
- [Coding with AI](/guides/coding-with-ai)