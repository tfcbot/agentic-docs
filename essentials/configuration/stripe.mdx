---
title: 'Stripe'
description: 'Set up Stripe for payment processing in your Agentic Templates'
---

# Stripe Configuration

[Stripe](https://stripe.com) handles payment processing and subscription management for your Agentic Templates application.

## Setup Steps

1. Create a Stripe Account:
   - Go to [stripe.com](https://stripe.com)
   - Sign up for a new account
   - Switch to test mode for development

2. Get API Keys:
   - Navigate to Developers → API keys in Stripe Dashboard
   - Copy your publishable and secret keys
   - Note: Keys starting with `pk_test_` and `sk_test_` are for testing

## Environment Variables

### API Service (.env)
```bash
# API Keys
STRIPE_SECRET_KEY=sk_test_...      # For server-side operations
STRIPE_WEBHOOK_SECRET=whsec_...     # For webhook verification

# Optional Configuration
STRIPE_PRICE_ID=price_...          # Your default subscription price
STRIPE_TRIAL_DAYS=14               # Trial period length
```

### Dashboard (.env)
```bash
# Client-side key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
```

## Webhook Configuration

1. Create Webhook Endpoint:
   - Go to Developers → Webhooks in Stripe Dashboard
   - Add endpoint: `https://api.yourdomain.com/webhooks/stripe`
   - Copy the signing secret for `STRIPE_WEBHOOK_SECRET`

2. Required Events:
   ```text
   customer.subscription.created
   customer.subscription.updated
   customer.subscription.deleted
   customer.updated
   customer.deleted
   payment_intent.succeeded
   payment_intent.payment_failed
   ```

3. Implement Webhook Handler:
   ```typescript
   import Stripe from 'stripe';
   import { buffer } from 'micro';

   const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);
   const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET!;

   export async function POST(req: Request) {
     const payload = await req.text();
     const sig = req.headers.get('stripe-signature')!;

     try {
       const event = stripe.webhooks.constructEvent(
         payload,
         sig,
         webhookSecret
       );

       switch (event.type) {
         case 'customer.subscription.created':
           // Handle subscription creation
           break;
         case 'payment_intent.succeeded':
           // Handle successful payment
           break;
         // Handle other events...
       }
     } catch (err) {
       console.error('Webhook Error:', err);
       return new Response('Webhook Error', { status: 400 });
     }

     return new Response('Success', { status: 200 });
   }
   ```

## Testing

1. Use test card numbers:
   ```text
   Success: 4242 4242 4242 4242
   Failure: 4000 0000 0000 0002
   ```

2. Test webhooks locally:
   ```bash
   # Install Stripe CLI
   stripe listen --forward-to localhost:3001/webhooks/stripe
   ```

## Best Practices

1. **Security**:
   - Never expose secret keys in client-side code
   - Always verify webhook signatures
   - Use environment-specific keys

2. **Error Handling**:
   - Implement proper error handling for failed payments
   - Set up monitoring for webhook failures
   - Configure customer communication for payment issues

3. **Testing**:
   - Test all webhook events
   - Verify subscription lifecycle
   - Test payment failure scenarios

## Next Steps

- [Return to Quickstart](/quickstart)
- [Set up CI/CD](/essentials/deployment)
- [Configure Monitoring](/essentials/monitoring) 